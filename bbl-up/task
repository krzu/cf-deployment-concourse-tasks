#!/bin/bash -xeu

function check_fast_fails() {
  set +x
  if [ -z "${LB_DOMAIN}" -a "${BBL_IAAS}" == "gcp" ]; then
    echo "\$LB_DOMAIN is a required parameter for gcp.  Please set the domain."
    exit 1
  fi

  if [ -z "${BBL_LB_CERT}"  ]; then
    echo "\$BBL_LB_CERT is a required parameter"
    exit 1
  fi

  if [ -z "${BBL_LB_KEY}"  ]; then
    echo "\$BBL_LB_KEY is a required parameter"
    exit 1
  fi

  if [ -n "${LB_DOMAIN}" -a "${BBL_IAAS}" == "aws" ]; then
    echo "\$LB_DOMAIN is not honored for aws"
  fi
  set -x
}

function write_service_account_key() {
  set +x
  if [ ! -f "${BBL_GCP_SERVICE_ACCOUNT_KEY}" ]; then
    echo "${BBL_GCP_SERVICE_ACCOUNT_KEY}" > /tmp/google_service_account.json
    export BBL_GCP_SERVICE_ACCOUNT_KEY="/tmp/google_service_account.json"
  fi
  set -x
}

function main() {

	check_fast_fails
	
	bbl version

	pwd
	ls
	ls ../
	ls ../..

	echo ${BBL_IAAS}
	echo ${BBL_GCP_SERVICE_ACCOUNT_KEY}
	echo ${BBL_GCP_PROJECT_ID}
	echo ${BBL_GCP_ZONE}
	echo ${BBL_GCP_REGION}
	echo ${BBL_STATE_DIR}
	echo ${BBL_LB_CERT}
	echo ${BBL_LB_KEY}
	echo ${LB_DOMAIN}
	echo ${BBL_ENV_NAME}
	cat ${BBL_GCP_SERVICE_ACCOUNT_KEY}
	
    bbl --debug up
}

main ${PWD}
